model Opportunity {
  id              String   @id @default(uuid())

  title           String
  description     String   @db.Text
  company         String?

  sourceId        String   @unique
  sourcePlatform  OpportunitySource
  sourceUrl       String

  category        OpportunityCategory
  tags            String[]

  budget          String?
  budgetMin       Float?
  budgetMax       Float?
  currency        String?

  location        String?
  isRemote        Boolean  @default(false)

  postedAt        DateTime
  expiresAt       DateTime?

  scrapedAt       DateTime @default(now())

  userNotifications UserOpportunityNotification[]
  views             OpportunityView[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([sourcePlatform])
  @@index([category])
  @@index([postedAt])
  @@index([scrapedAt])
  @@index([isRemote])
  @@index([sourcePlatform, createdAt])
  @@index([category, postedAt])
  @@index([createdAt])
}

model UserOpportunityNotification {
  id             String      @id @default(uuid())

  userId         String
  user           User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  opportunityId  String
  opportunity    Opportunity @relation(fields: [opportunityId], references: [id], onDelete: Cascade)

  notifiedAt     DateTime    @default(now())

  @@unique([userId, opportunityId])
  @@index([userId])
  @@index([opportunityId])
}

model UserOpportunityPreferences {
  id                    String   @id @default(uuid())

  userId                String   @unique
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  discordWebhook        String?
  enableDiscordNotifications Boolean @default(false)

  enabledSources        OpportunitySource[] @default([MALT, CODEUR, FREELANCE_INFORMATIQUE, COMET, LE_HIBOU, UPWORK, FIVERR, FREELANCER, TOPTAL, WE_WORK_REMOTELY, REMOTE_CO, REMOTIVE, LINKEDIN, INDEED, GURU, PEOPLEPERHOUR])
  enabledCategories     OpportunityCategory[] @default([WEB_DEVELOPMENT, WEB_DESIGN, MOBILE_DEVELOPMENT, UI_UX_DESIGN, FRONTEND, BACKEND, FULLSTACK, DEVOPS, DATA_SCIENCE, MACHINE_LEARNING, BLOCKCHAIN, GAME_DEVELOPMENT, WORDPRESS, ECOMMERCE, SEO, CONTENT_WRITING, COPYWRITING, GRAPHIC_DESIGN, VIDEO_EDITING, MARKETING, CONSULTING, OTHER])

  keywords              String[] @default([])
  excludeKeywords       String[] @default([])

  minBudget             Float?
  remoteOnly            Boolean  @default(false)

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

enum OpportunitySource {
  MALT
  CODEUR
  FREELANCE_INFORMATIQUE
  COMET
  LE_HIBOU
  UPWORK
  FIVERR
  FREELANCER
  TOPTAL
  WE_WORK_REMOTELY
  REMOTE_CO
  REMOTIVE
  LINKEDIN
  INDEED
  GURU
  PEOPLEPERHOUR
}

enum OpportunityCategory {
  WEB_DEVELOPMENT
  WEB_DESIGN
  MOBILE_DEVELOPMENT
  UI_UX_DESIGN
  FRONTEND
  BACKEND
  FULLSTACK
  DEVOPS
  DATA_SCIENCE
  MACHINE_LEARNING
  BLOCKCHAIN
  GAME_DEVELOPMENT
  WORDPRESS
  ECOMMERCE
  SEO
  CONTENT_WRITING
  COPYWRITING
  GRAPHIC_DESIGN
  VIDEO_EDITING
  MARKETING
  CONSULTING
  OTHER
}
